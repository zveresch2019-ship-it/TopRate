const mongoose = require('mongoose');
require('dotenv').config();

async function fixUserRoles() {
  try {
    console.log('Connecting to MongoDB...');
    await mongoose.connect(process.env.MONGODB_URI);
    console.log('âœ… Connected to MongoDB');

    const User = require('./models/User');
    
    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹, Ñƒ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… ĞµÑÑ‚ÑŒ groupId, ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ Ğ¸Ğ¼ Ñ€Ğ¾Ğ»ÑŒ admin
    const result = await User.updateMany(
      { groupId: { $exists: true, $ne: null } },
      { $set: { role: 'admin' } }
    );
    
    console.log(`âœ… Updated ${result.modifiedCount} users to admin role`);

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    const users = await User.find({});
    console.log('Updated users:');
    users.forEach(user => {
      console.log(`- ${user.username}: ${user.role}`);
    });

  } catch (error) {
    console.error('âŒ Error:', error);
  } finally {
    await mongoose.disconnect();
    console.log('ğŸ”Œ Disconnected from MongoDB');
  }
}

fixUserRoles();
